<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0&display=swap" rel="stylesheet" />
<title>Image Search</title>
<style>
:root {
  --bg: #F9F5EC;
  --accent: #4A5759;
  --pill-bg: rgba(255,255,255,0.65);
}
html,body {
  margin:0;
  padding:0;
  background:var(--bg);
  font-family:'Inter',sans-serif;
  color:var(--accent);
  -webkit-font-smoothing:antialiased;
}
main {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  padding:12px;
}
figure {
  margin:0;
  position:relative;
  overflow:hidden;
  border-radius:16px;
  aspect-ratio:1/1;
}
figure img {
  width:100%;
  height:100%;
  object-fit:cover;
  opacity:0;
  transform:translateY(24px) translateX(-10px);
  transition:opacity .4s ease, transform .4s ease;
  transition-delay:var(--delay,0ms);
  border-radius:inherit;
}
figure.visible img {
  opacity:1;
  transform:none;
}
@media (prefers-reduced-motion: reduce) {
  figure img {transition:opacity .2s ease; transform:none;}
}
#search-bar {
  position:fixed;
  left:0; right:0; bottom:0;
  display:flex;
  justify-content:center;
  padding:0 16px calc(env(safe-area-inset-bottom) + 16px);
  pointer-events:none;
}
#search-form {
  display:flex;
  align-items:center;
  width:100%;
  max-width:500px;
  background:var(--pill-bg);
  backdrop-filter:blur(10px);
  border-radius:32px;
  padding:8px 12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.05);
  pointer-events:auto;
  transition:transform .2s cubic-bezier(.2,.8,.2,1);
}
#search-form:active {transform:scale(.96);}
#query {
  flex:1;
  border:none;
  background:transparent;
  font-size:16px;
  outline:none;
  padding:8px;
}
#query::placeholder {color:var(--accent); opacity:.6;}
button {
  border:none;
  background:transparent;
  padding:8px;
  border-radius:24px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:background .2s, transform .2s cubic-bezier(.2,.8,.2,1);
}
button:active {transform:scale(.96);}
button:hover {background:rgba(0,0,0,0.05);}
.material-symbols-rounded {
  font-variation-settings:'FILL' 0, 'wght' 600, 'GRAD' 0, 'opsz' 24;
  font-size:24px;
}
@media (prefers-reduced-motion: reduce) {
  #search-form,button{transition:none;}
}
</style>
</head>
<body>
<main id="gallery"></main>
<div id="search-bar">
  <form id="search-form">
    <input id="query" type="text" placeholder="Search" autocomplete="off" />
    <button type="submit"><span class="material-symbols-rounded">search</span></button>
  </form>
</div>
<script>
const gallery=document.getElementById('gallery');
const form=document.getElementById('search-form');
const input=document.getElementById('query');
let page=1; let term=''; let loading=false;
async function fetchImages(reset=false){
  if(reset){gallery.innerHTML=''; page=1;}
  const url=`https://api.openverse.org/v1/images/?page=${page}&page_size=20&q=${encodeURIComponent(term)}`;
  try{
    const res=await fetch(url);
    const data=await res.json();
    const frag=document.createDocumentFragment();
    data.results.forEach((imgData,i)=>{
      const fig=document.createElement('figure');
      const img=document.createElement('img');
      img.src=imgData.thumbnail || imgData.url;
      img.alt=imgData.title || term;
      const order=gallery.childElementCount + i;
      fig.style.setProperty('--delay', order*40 + 'ms');
      fig.appendChild(img);
      frag.appendChild(fig);
      observer.observe(fig);
    });
    gallery.appendChild(frag);
    page++;
  }catch(e){console.error(e);}
}
form.addEventListener('submit',e=>{
  e.preventDefault();
  term=input.value.trim();
  if(!term)return;
  fetchImages(true);
});
const observer=new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){entry.target.classList.add('visible'); observer.unobserve(entry.target);}
  });
},{rootMargin:'100px 0px 100px 0px',threshold:0.01});
function onScroll(){
  if(loading) return;
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 500){
    loading=true;
    fetchImages().finally(()=>loading=false);
  }
}
window.addEventListener('scroll',onScroll);
</script>
</body>
</html>
