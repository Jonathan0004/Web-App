<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Calendar</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0&display=swap" rel="stylesheet">
<style>
:root{--vh:1vh;}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;background:#F9F5EC;font-family:'Inter',sans-serif;-webkit-user-select:none;user-select:none;}
main{height:calc(var(--vh)*100);display:flex;flex-direction:column;}
header{display:flex;align-items:center;justify-content:space-between;padding:16px;font-weight:600;}
header .material-symbols-rounded{font-size:24px;}
#weekdays{display:grid;grid-template-columns:repeat(7,1fr);text-align:center;font-size:14px;opacity:.6;padding:0 8px;}
#calendar{flex:1;display:grid;grid-template-columns:repeat(7,1fr);padding:8px;gap:4px;}
.day{position:relative;display:flex;align-items:center;justify-content:center;aspect-ratio:1;border-radius:12px;}
.day span{position:relative;z-index:1;}
.day.today{background:rgba(0,0,0,.05);}
.day .dot{position:absolute;bottom:6px;width:6px;height:6px;border-radius:3px;background:#007AFF;}
nav{position:fixed;left:50%;bottom:calc(env(safe-area-inset-bottom) + 16px);transform:translateX(-50%);display:flex;gap:12px;z-index:10;}
.pill{width:64px;height:40px;border:none;border-radius:20px;background:rgba(255,255,255,.6);backdrop-filter:blur(20px);display:flex;align-items:center;justify-content:center;padding:0;color:#222;cursor:pointer;}
.pill span{font-size:24px;line-height:1;}
dialog{border:none;border-radius:16px;padding:20px;max-width:90%;background:rgba(255,255,255,.9);backdrop-filter:blur(20px);}
dialog h2{font-size:18px;margin-bottom:12px;}
dialog form{display:flex;gap:8px;margin-top:12px;}
dialog input{flex:1;border:none;border-radius:20px;padding:8px 12px;background:rgba(255,255,255,.6);}
dialog button{border:none;border-radius:20px;padding:8px 12px;background:rgba(255,255,255,.6);}
#eventList{list-style:none;max-height:200px;overflow:auto;padding:0;}
#eventList li{display:flex;justify-content:space-between;align-items:center;padding:4px 0;}
#eventList li span:first-child{flex:1;}
#eventList li button{background:none;padding:0;margin:0;}
#eventList li button span{font-size:20px;}
#searchResults{list-style:none;max-height:200px;overflow:auto;padding:0;margin-top:8px;}
.fade{animation:fade .3s ease;}
@keyframes fade{from{opacity:0;transform:scale(.97);}to{opacity:1;transform:scale(1);}}
</style>
</head>
<body>
<main>
<header>
<button id="prev" class="pill"><span class="material-symbols-rounded">chevron_left</span></button>
<div id="month"></div>
<button id="next" class="pill"><span class="material-symbols-rounded">chevron_right</span></button>
</header>
<div id="weekdays"></div>
<div id="calendar"></div>
</main>
<nav>
<button id="searchBtn" class="pill"><span class="material-symbols-rounded">search</span></button>
<button id="addBtn" class="pill"><span class="material-symbols-rounded">add</span></button>
<button id="todayBtn" class="pill"><span class="material-symbols-rounded">today</span></button>
</nav>
<dialog id="eventDialog">
<h2 id="eventDate"></h2>
<ul id="eventList"></ul>
<form id="eventForm" method="dialog">
<input id="eventInput" type="text" placeholder="Event">
<button type="submit"><span class="material-symbols-rounded">add</span></button>
</form>
</dialog>
<dialog id="searchDialog">
<form id="searchForm" method="dialog">
<input id="searchInput" type="text" placeholder="Search">
<button type="submit"><span class="material-symbols-rounded">search</span></button>
</form>
<ul id="searchResults"></ul>
</dialog>
<script>
const state={date:new Date(),events:JSON.parse(localStorage.getItem('events')||'{}')};
const monthEl=document.getElementById('month');
const weekdaysEl=document.getElementById('weekdays');
const calendarEl=document.getElementById('calendar');
const eventDialog=document.getElementById('eventDialog');
const eventDateEl=document.getElementById('eventDate');
const eventList=document.getElementById('eventList');
const eventForm=document.getElementById('eventForm');
const eventInput=document.getElementById('eventInput');
const searchDialog=document.getElementById('searchDialog');
const searchForm=document.getElementById('searchForm');
const searchInput=document.getElementById('searchInput');
const searchResults=document.getElementById('searchResults');

function setVH(){document.documentElement.style.setProperty('--vh',(window.innerHeight*0.01)+'px');}
setVH();addEventListener('resize',setVH);

const weekdays=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
weekdaysEl.innerHTML=weekdays.map(d=>`<div>${d}</div>`).join('');

function renderCalendar(){
const year=state.date.getFullYear();
const month=state.date.getMonth();
monthEl.textContent=state.date.toLocaleDateString(undefined,{month:'long',year:'numeric'});
calendarEl.innerHTML='';
const first=new Date(year,month,1).getDay();
const days=new Date(year,month+1,0).getDate();
for(let i=0;i<first;i++) calendarEl.appendChild(document.createElement('div'));
for(let d=1;d<=days;d++){
 const dateStr=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
 const cell=document.createElement('div');
 cell.className='day fade';
 if(dateStr===todayStr()) cell.classList.add('today');
 cell.innerHTML=`<span>${d}</span>`;
 if(state.events[dateStr]){const dot=document.createElement('div');dot.className='dot';cell.appendChild(dot);}
 cell.onclick=()=>openEvents(dateStr);
 calendarEl.appendChild(cell);
}
}
function todayStr(){
const t=new Date();
return `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`;
}
function openEvents(dateStr){
eventDateEl.textContent=new Date(dateStr).toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'});
eventDialog.returnValue='';
eventDialog.showModal();
renderEvents(dateStr);
eventForm.onsubmit=e=>{
 e.preventDefault();
 const text=eventInput.value.trim();
 if(!text) return;
 (state.events[dateStr]=state.events[dateStr]||[]).push(text);
 localStorage.setItem('events',JSON.stringify(state.events));
 eventInput.value='';
 renderEvents(dateStr);
 renderCalendar();
};
eventDialog.onclick=e=>{if(e.target===eventDialog)eventDialog.close();};
}
function renderEvents(dateStr){
eventInput.value='';
eventList.innerHTML='';
(state.events[dateStr]||[]).forEach((ev,i)=>{
 const li=document.createElement('li');
 li.innerHTML=`<span>${ev}</span><button data-i="${i}"><span class="material-symbols-rounded">close</span></button>`;
 eventList.appendChild(li);
});
eventList.querySelectorAll('button').forEach(btn=>btn.onclick=()=>{
 const i=btn.getAttribute('data-i');
 state.events[dateStr].splice(i,1);
 if(!state.events[dateStr].length) delete state.events[dateStr];
 localStorage.setItem('events',JSON.stringify(state.events));
 renderEvents(dateStr);
 renderCalendar();
});
}

document.getElementById('prev').onclick=()=>{state.date.setMonth(state.date.getMonth()-1);renderCalendar();};
document.getElementById('next').onclick=()=>{state.date.setMonth(state.date.getMonth()+1);renderCalendar();};
document.getElementById('todayBtn').onclick=()=>{state.date=new Date();renderCalendar();};
document.getElementById('addBtn').onclick=()=>{
 const ds=todayStr();
 openEvents(ds);
};
document.getElementById('searchBtn').onclick=()=>{searchInput.value='';searchResults.innerHTML='';searchDialog.showModal();searchInput.focus();};
searchForm.onsubmit=e=>{
 e.preventDefault();
 const q=searchInput.value.trim().toLowerCase();
 searchResults.innerHTML='';
 if(!q) return;
 Object.keys(state.events).forEach(date=>{
 state.events[date].forEach(ev=>{
 if(ev.toLowerCase().includes(q)){
 const li=document.createElement('li');
 li.textContent=`${new Date(date).toLocaleDateString(undefined,{month:'short',day:'numeric'})}: ${ev}`;
 searchResults.appendChild(li);
 }
 });
 });
};
searchDialog.onclick=e=>{if(e.target===searchDialog)searchDialog.close();};
renderCalendar();
</script>
</body>
</html>
