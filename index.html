<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0&display=swap" rel="stylesheet" />
<title>Image Search</title>
<style>
:root {
  --bg: #F9F5EC;
  --accent: #4A5759;
  --pill-bg: rgba(255,255,255,0.65);
}
html,body {
  margin:0;
  padding:0;
  background:var(--bg);
  font-family:'Inter',sans-serif;
  color:var(--accent);
  -webkit-font-smoothing:antialiased;
}
main {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  padding:12px;
}
figure {
  margin:0;
  position:relative;
  overflow:hidden;
  border-radius:16px;
  aspect-ratio:1/1;
}
figure img {
  width:100%;
  height:100%;
  object-fit:cover;
  opacity:0;
  transform:translateY(24px) translateX(-10px);
  transition:opacity .4s ease, transform .4s ease;
  transition-delay:var(--delay,0ms);
  border-radius:inherit;
}
figure.visible img {
  opacity:1;
  transform:none;
}
@media (prefers-reduced-motion: reduce) {
  figure img {transition:opacity .2s ease; transform:none;}
}
#controls {
  position:fixed;
  left:0; right:0; bottom:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  padding:0 16px calc(env(safe-area-inset-bottom) + 16px);
  pointer-events:none;
}
#suggestions {
  display:flex;
  gap:8px;
  pointer-events:none;
}
#suggestions .tag {
  background:var(--pill-bg);
  backdrop-filter:blur(10px);
  border-radius:16px;
  padding:6px 10px;
  opacity:0;
  transform:translateY(8px);
  transition:opacity .2s, transform .2s;
  pointer-events:auto;
}
#suggestions .tag.visible {opacity:1; transform:none;}
#search-form {
  display:flex;
  align-items:center;
  width:100%;
  max-width:500px;
  background:var(--pill-bg);
  backdrop-filter:blur(10px);
  border-radius:32px;
  padding:8px 12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.05);
  pointer-events:auto;
  transition:transform .2s cubic-bezier(.2,.8,.2,1);
}
#search-form:active {transform:scale(.96);}
#query {
  flex:1;
  border:none;
  background:transparent;
  font-size:16px;
  outline:none;
  padding:8px;
}
#query::placeholder {color:var(--accent); opacity:.6;}
#nav {
  display:flex;
  background:var(--pill-bg);
  backdrop-filter:blur(10px);
  border-radius:32px;
  padding:6px;
  box-shadow:0 4px 12px rgba(0,0,0,0.05);
  pointer-events:auto;
}
#nav button {
  border:none;
  background:transparent;
  padding:8px;
  border-radius:28px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:background .2s, transform .2s cubic-bezier(.2,.8,.2,1);
}
#nav button.active {background:rgba(0,0,0,0.05);}
button:active {transform:scale(.96);}
.material-symbols-rounded {
  font-variation-settings:'FILL' 0, 'wght' 600, 'GRAD' 0, 'opsz' 24;
  font-size:24px;
}
#overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.2);
  backdrop-filter:blur(20px);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity .3s;
}
#overlay.show {opacity:1; pointer-events:auto;}
#overlay-content {
  position:relative;
  background:var(--pill-bg);
  backdrop-filter:blur(20px);
  border-radius:24px;
  padding:16px;
  transform:translateY(40px) scale(.96);
  opacity:0;
  transition:transform .3s cubic-bezier(.2,.8,.2,1), opacity .3s;
}
#overlay.show #overlay-content {transform:none; opacity:1;}
#overlay img {max-width:80vw; max-height:60vh; border-radius:16px; display:block;}
#close-overlay, #fav-toggle {
  position:absolute;
  top:8px;
  width:32px; height:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:16px;
  padding:4px;
}
#close-overlay {right:8px;}
#fav-toggle {left:8px;}
#fav-toggle.saved span {font-variation-settings:'FILL' 1, 'wght' 600, 'GRAD' 0, 'opsz' 24;}
@media (prefers-reduced-motion: reduce) {
  #search-form,button,#nav button,#overlay,#overlay-content,#suggestions .tag{transition:none;}
}
</style>
</head>
<body>
<main id="gallery"></main>
<main id="favorites" hidden></main>
<div id="overlay">
  <div id="overlay-content">
    <button id="close-overlay"><span class="material-symbols-rounded">close</span></button>
    <img id="overlay-img" alt="" />
    <button id="fav-toggle"><span class="material-symbols-rounded">star</span></button>
  </div>
</div>
<div id="controls">
  <div id="suggestions"></div>
  <form id="search-form">
    <input id="query" type="text" placeholder="Search" autocomplete="off" />
    <button type="submit"><span class="material-symbols-rounded">search</span></button>
  </form>
  <nav id="nav">
    <button data-tab="search" class="active"><span class="material-symbols-rounded">image</span></button>
    <button data-tab="fav"><span class="material-symbols-rounded">star</span></button>
  </nav>
</div>
<script>
const gallery=document.getElementById('gallery');
const favGallery=document.getElementById('favorites');
const form=document.getElementById('search-form');
const input=document.getElementById('query');
const overlay=document.getElementById('overlay');
const overlayImg=document.getElementById('overlay-img');
const closeOverlay=document.getElementById('close-overlay');
const favToggle=document.getElementById('fav-toggle');
const suggestions=document.getElementById('suggestions');
const navButtons=document.querySelectorAll('#nav button');
let page=1; let term=''; let loading=false; let currentData=null;
let favorites=JSON.parse(localStorage.getItem('favorites')||'{}');
async function fetchImages(reset=false){
  if(reset){gallery.innerHTML=''; page=1;}
  const url=`https://api.openverse.org/v1/images/?page=${page}&page_size=20&q=${encodeURIComponent(term)}`;
  try{
    const res=await fetch(url);
    const data=await res.json();
    const frag=document.createDocumentFragment();
    data.results.forEach((imgData,i)=>{
      const fig=document.createElement('figure');
      const img=document.createElement('img');
      img.src=imgData.thumbnail || imgData.url;
      img.alt=imgData.title || term;
      fig.addEventListener('click',()=>openOverlay(imgData));
      const order=gallery.childElementCount + i;
      fig.style.setProperty('--delay', order*40 + 'ms');
      fig.appendChild(img);
      frag.appendChild(fig);
      observer.observe(fig);
    });
    gallery.appendChild(frag);
    page++;
  }catch(e){console.error(e);}
}
function openOverlay(data){
  currentData=data;
  const id=data.id || data.url;
  overlayImg.src=data.url || data.thumbnail;
  overlayImg.alt=data.title || '';
  overlay.dataset.id=id;
  updateFavButton();
  overlay.classList.add('show');
}
function close(){overlay.classList.remove('show');}
closeOverlay.addEventListener('click',close);
overlay.addEventListener('click',e=>{if(e.target===overlay)close();});
function updateFavButton(){
  const id=overlay.dataset.id;
  if(favorites[id]) favToggle.classList.add('saved'); else favToggle.classList.remove('saved');
}
favToggle.addEventListener('click',()=>{
  const id=overlay.dataset.id;
  if(favorites[id]){delete favorites[id];}
  else{favorites[id]=currentData;}
  localStorage.setItem('favorites',JSON.stringify(favorites));
  updateFavButton();
  renderFavorites();
});
function renderFavorites(){
  favGallery.innerHTML='';
  const frag=document.createDocumentFragment();
  Object.values(favorites).forEach((data,i)=>{
    const fig=document.createElement('figure');
    const img=document.createElement('img');
    img.src=data.thumbnail || data.url;
    img.alt=data.title || '';
    fig.addEventListener('click',()=>openOverlay(data));
    fig.style.setProperty('--delay', i*40 + 'ms');
    fig.appendChild(img);
    frag.appendChild(fig);
    observer.observe(fig);
  });
  favGallery.appendChild(frag);
}
form.addEventListener('submit',e=>{
  e.preventDefault();
  term=input.value.trim();
  if(!term)return;
  fetchImages(true);
  let history=JSON.parse(localStorage.getItem('history')||'[]');
  if(!history.includes(term)){history.push(term); localStorage.setItem('history',JSON.stringify(history));}
});
function showSuggestions(){
  const history=JSON.parse(localStorage.getItem('history')||'[]').slice(-3).reverse();
  suggestions.innerHTML='';
  history.forEach((t,i)=>{
    const tag=document.createElement('span');
    tag.className='tag';
    tag.textContent=t;
    tag.style.transitionDelay=`${i*40}ms`;
    tag.addEventListener('click',()=>{input.value=t; term=t; fetchImages(true); hideSuggestions();});
    suggestions.appendChild(tag);
    requestAnimationFrame(()=>tag.classList.add('visible'));
  });
}
function hideSuggestions(){
  suggestions.querySelectorAll('.tag').forEach(tag=>tag.classList.remove('visible'));
  setTimeout(()=>suggestions.innerHTML='',200);
}
input.addEventListener('focus',showSuggestions);
input.addEventListener('blur',()=>setTimeout(hideSuggestions,100));
navButtons.forEach(btn=>btn.addEventListener('click',()=>{
  navButtons.forEach(b=>b.classList.toggle('active',b===btn));
  const tab=btn.dataset.tab;
  if(tab==='search'){
    gallery.hidden=false; favGallery.hidden=true; form.style.display='flex';
  }else{
    gallery.hidden=true; favGallery.hidden=false; form.style.display='none';
    renderFavorites();
  }
}));
const observer=new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){entry.target.classList.add('visible'); observer.unobserve(entry.target);}
  });
},{rootMargin:'100px 0px 100px 0px',threshold:0.01});
function onScroll(){
  if(loading || gallery.hidden) return;
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 500){
    loading=true;
    fetchImages().finally(()=>loading=false);
  }
}
window.addEventListener('scroll',onScroll);
</script>
</body>
</html>
