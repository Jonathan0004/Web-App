<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded&display=swap" rel="stylesheet" />
<title>Editr</title>
<style>
:root {
  --bg:#F9F5EC;
  --accent:#4C7DFE;
  --pill-bg:rgba(255,255,255,0.6);
  --pill-blur:12px;
}
html,body {
  margin:0;
  padding:0;
  background:var(--bg);
  font-family:'Inter',sans-serif;
  -webkit-font-smoothing:antialiased;
  touch-action:manipulation;
}
canvas {
  display:block;
  max-width:100%;
  margin:0 auto;
}
#controls {
  position:fixed;
  left:50%;
  bottom:0;
  transform:translateX(-50%);
  display:flex;
  gap:12px;
  padding:12px 20px calc(env(safe-area-inset-bottom) + 12px);
  background:var(--pill-bg);
  backdrop-filter:blur(var(--pill-blur));
  border-radius:32px;
  box-shadow:0 4px 12px rgba(0,0,0,0.05);
  pointer-events:auto;
}
button {
  background:transparent;
  border:none;
  border-radius:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  width:56px;
  height:56px;
  cursor:pointer;
  transition:background .2s, transform .2s cubic-bezier(.34,1.56,.64,1);
}
button span.material-symbols-rounded {
  font-size:28px;
  line-height:1;
  color:var(--accent);
}
button.pressed {transform:scale(.96);}
button.selected {background:rgba(0,0,0,0.05);}
.sheet {
  position:fixed;
  left:0; right:0; bottom:0;
  transform:translateY(100%);
  opacity:0;
  transition:transform .24s cubic-bezier(.34,1.56,.64,1), opacity .24s;
  background:var(--pill-bg);
  backdrop-filter:blur(var(--pill-blur));
  border-top-left-radius:24px;
  border-top-right-radius:24px;
  padding:20px;
  box-shadow:0 -4px 12px rgba(0,0,0,0.05);
}
.sheet.show {transform:none; opacity:1;}
.sheet header {
  display:flex;
  justify-content:flex-end;
}
.sheet header button {
  width:40px; height:40px;
}
.sheet header button span {color:var(--accent);}
.slider {
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-top:8px;
}
.slider label {
  font-size:14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.slider label span {margin-left:8px;}
input[type=range] {
  -webkit-appearance:none;
  width:100%;
  height:4px;
  border-radius:2px;
  background:rgba(0,0,0,0.1);
  outline:none;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance:none;
  width:24px; height:24px;
  border-radius:50%;
  background:var(--accent);
  box-shadow:0 2px 4px rgba(0,0,0,0.2);
  transition:transform .2s cubic-bezier(.34,1.56,.64,1);
}
input[type=range]:active::-webkit-slider-thumb {
  transform:scale(.9);
}
.filters {
  display:flex;
  gap:12px;
  margin-top:12px;
}
.filters button {
  width:64px; height:64px;
  flex-direction:column;
  padding:8px;
}
.filters button img {
  width:100%;
  border-radius:16px;
}
.filters button span.label {
  margin-top:4px;
  font-size:12px;
  color:var(--accent);
}
.filters button.selected {background:rgba(0,0,0,0.05);}
#backdrop {
  position:fixed; inset:0;
  background:rgba(0,0,0,0.2);
  backdrop-filter:blur(2px);
  opacity:0; pointer-events:none;
  transition:opacity .24s;
}
#backdrop.show {opacity:1; pointer-events:auto;}
@media (prefers-reduced-motion: reduce) {
  button, .sheet, #backdrop {transition:opacity .2s;}
  button.pressed {transform:none;}
  .sheet {transform:none;}
}
</style>
</head>
<body>
<input type="file" id="file-input" accept="image/*" hidden />
<canvas id="canvas"></canvas>
<div id="backdrop"></div>
<div id="filter-sheet" class="sheet">
  <header><button id="close-filter"><span class="material-symbols-rounded">close</span></button></header>
  <div class="filters">
    <button data-filter="none" class="selected"><img id="preview-none" alt=""><span class="label">None</span></button>
    <button data-filter="grayscale(1)"><img id="preview-bw" alt=""><span class="label">B&W</span></button>
    <button data-filter="sepia(1)"><img id="preview-sepia" alt=""><span class="label">Sepia</span></button>
    <button data-filter="invert(1)"><img id="preview-invert" alt=""><span class="label">Invert</span></button>
  </div>
</div>
<div id="adjust-sheet" class="sheet">
  <header><button id="close-adjust"><span class="material-symbols-rounded">close</span></button></header>
  <div class="slider">
    <label>Bright<input type="range" id="brightness" min="0" max="2" step="0.01" value="1" /></label>
    <label>Contrast<input type="range" id="contrast" min="0" max="2" step="0.01" value="1" /></label>
    <label>Satur<input type="range" id="saturation" min="0" max="2" step="0.01" value="1" /></label>
  </div>
</div>
<div id="controls">
  <button id="open"><span class="material-symbols-rounded">image</span></button>
  <button id="filters"><span class="material-symbols-rounded">filter</span></button>
  <button id="adjust"><span class="material-symbols-rounded">tune</span></button>
  <button id="rotate"><span class="material-symbols-rounded">rotate_90_degrees_cw</span></button>
  <button id="save"><span class="material-symbols-rounded">download</span></button>
</div>
<script>
const fileInput=document.getElementById('file-input');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
let img=new Image();
let rotation=0;
let flipH=1;
let filter='none';
let brightness=1,contrast=1,saturation=1;

function render(){
  if(!img.src)return;
  const w=img.naturalWidth;
  const h=img.naturalHeight;
  const angle=rotation%360;
  const rad=angle*Math.PI/180;
  const cos=Math.cos(rad), sin=Math.sin(rad);
  const newW=Math.abs(w*cos)+Math.abs(h*sin);
  const newH=Math.abs(w*sin)+Math.abs(h*cos);
  canvas.width=newW;
  canvas.height=newH;
  ctx.save();
  ctx.translate(newW/2,newH/2);
  ctx.rotate(rad);
  ctx.scale(flipH,1);
  ctx.filter=`${filter} brightness(${brightness}) contrast(${contrast}) saturate(${saturation})`;
  ctx.drawImage(img,-w/2,-h/2);
  ctx.restore();
  updatePreviews();
}

fileInput.addEventListener('change',e=>{
  const file=e.target.files[0];
  if(!file)return;
  img.src=URL.createObjectURL(file);
  img.onload=()=>{rotation=0;flipH=1;filter='none';brightness=1;contrast=1;saturation=1;render();};
});

function openSheet(name){
  document.getElementById(name+'-sheet').classList.add('show');
  backdrop.classList.add('show');
}
function closeSheet(name){
  document.getElementById(name+'-sheet').classList.remove('show');
  backdrop.classList.remove('show');
}

document.getElementById('open').addEventListener('click',()=>fileInput.click());
document.getElementById('rotate').addEventListener('click',()=>{rotation+=90;render();});
document.getElementById('save').addEventListener('click',()=>{
  const link=document.createElement('a');
  link.download='image.png';
  link.href=canvas.toDataURL();
  link.click();
});
const backdrop=document.getElementById('backdrop');
document.getElementById('filters').addEventListener('click',()=>openSheet('filter'));
document.getElementById('adjust').addEventListener('click',()=>openSheet('adjust'));
document.getElementById('close-filter').addEventListener('click',()=>closeSheet('filter'));
document.getElementById('close-adjust').addEventListener('click',()=>closeSheet('adjust'));
document.getElementById('brightness').addEventListener('input',e=>{brightness=e.target.value;render();});
document.getElementById('contrast').addEventListener('input',e=>{contrast=e.target.value;render();});
document.getElementById('saturation').addEventListener('input',e=>{saturation=e.target.value;render();});
const filterSheet=document.getElementById('filter-sheet');
filterSheet.querySelectorAll('.filters button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    filterSheet.querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    filter=btn.dataset.filter==='none'?'none':btn.dataset.filter;
    render();
  });
});
document.querySelectorAll('button').forEach(btn=>{
  ['touchstart','mousedown'].forEach(ev=>btn.addEventListener(ev,()=>btn.classList.add('pressed')));
  ['touchend','mouseup','mouseleave'].forEach(ev=>btn.addEventListener(ev,()=>btn.classList.remove('pressed')));
});

function updatePreviews(){
  if(!img.src)return;
  const canv=document.createElement('canvas');
  const cctx=canv.getContext('2d');
  const size=64;
  canv.width=size; canv.height=size;
  cctx.drawImage(img,0,0,size,size);
  const data=canv.toDataURL();
  document.getElementById('preview-none').src=data;
  document.getElementById('preview-bw').src=data;
  document.getElementById('preview-sepia').src=data;
  document.getElementById('preview-invert').src=data;
  document.getElementById('preview-bw').style.filter='grayscale(1)';
  document.getElementById('preview-sepia').style.filter='sepia(1)';
  document.getElementById('preview-invert').style.filter='invert(1)';
}
</script>
</body>
</html>
