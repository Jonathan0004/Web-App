<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>Weather</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@600&display=swap" rel="stylesheet">
<style>
:root{--bg:#F9F5EC;--acc:#a67c52;}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;background:var(--bg);color:#222;font-family:'Inter',sans-serif;}
#view{height:calc(var(--vh,1vh)*100);display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:0 16px;}
#city{font-size:18px;margin-bottom:4px;}
#temp{font-size:72px;font-weight:500;}
#desc{font-size:20px;margin-top:4px;color:var(--acc);}
#bar{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(env(safe-area-inset-bottom) + 16px);width:90%;max-width:500px;display:flex;gap:12px;align-items:center;}
.pill{height:48px;border-radius:999px;background:rgba(255,255,255,0.8);backdrop-filter:blur(20px);box-shadow:0 4px 16px rgba(0,0,0,0.1);display:flex;align-items:center;}
.icon{width:48px;border:none;background:transparent;display:flex;align-items:center;justify-content:center;border-radius:999px;cursor:pointer;}
.material-symbols-rounded{font-variation-settings:'FILL' 0,'wght' 600,'GRAD' 0,'opsz' 24;font-size:24px;color:#555;}
form.flex{flex:1;display:flex;padding:0 12px;}
form.flex input{flex:1;border:none;background:transparent;font-size:16px;padding:0 8px;}
form.flex input:focus{outline:none;}
form.flex button{border:none;background:transparent;border-radius:999px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;margin-left:4px;}
.hidden{display:none;}
.fade{opacity:0;transform:translateY(8px);transition:opacity .3s ease,transform .3s ease;}
.fade.show{opacity:1;transform:translateY(0);}
</style>
</head>
<body>
<main id="view">
  <div id="city" class="fade"></div>
  <div id="temp" class="fade"></div>
  <div id="desc" class="fade"></div>
</main>
<nav id="bar">
  <button id="loc" class="pill icon"><span class="material-symbols-rounded">my_location</span></button>
  <form id="search" class="pill flex">
    <input id="q" placeholder="City" autocomplete="off">
    <button type="button" id="clear" class="hidden"><span class="material-symbols-rounded">close</span></button>
    <button type="submit"><span class="material-symbols-rounded">search</span></button>
  </form>
  <button id="reload" class="pill icon"><span class="material-symbols-rounded">refresh</span></button>
</nav>
<script>
const cityEl=document.getElementById('city'),tempEl=document.getElementById('temp'),descEl=document.getElementById('desc');
const form=document.getElementById('search'),q=document.getElementById('q'),clearBtn=document.getElementById('clear');
const locBtn=document.getElementById('loc'),reloadBtn=document.getElementById('reload');
let lastPos=null;
function setVH(){document.documentElement.style.setProperty('--vh',window.innerHeight*0.01+'px');}
setVH();window.addEventListener('resize',setVH);
function show(el,text){el.textContent=text;el.classList.add('show');}
function weatherDesc(code){return({0:'Clear',1:'Mainly Clear',2:'Cloudy',3:'Overcast',45:'Fog',48:'Fog',51:'Drizzle',53:'Drizzle',55:'Drizzle',61:'Rain',63:'Rain',65:'Rain',71:'Snow',73:'Snow',75:'Snow',80:'Shower',81:'Shower',82:'Shower',95:'Storm'}[code]||'Weather');}
async function getWeather(lat,lon,name){lastPos={lat,lon,name};const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`);const j=await r.json();const w=j.current_weather;show(cityEl,(name||'').split(' ').slice(0,3).join(' '));show(tempEl,Math.round(w.temperature)+'Â°');show(descEl,weatherDesc(w.weathercode));}
form.addEventListener('submit',async e=>{e.preventDefault();const v=q.value.trim();if(!v)return;const r=await fetch(`https://geocoding-api.open-meteo.com/v1/search?count=1&name=${encodeURIComponent(v)}`);const j=await r.json();if(j.results&&j.results[0]){const s=j.results[0];getWeather(s.latitude,s.longitude,s.name);}});
locBtn.addEventListener('click',()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(p=>getWeather(p.coords.latitude,p.coords.longitude,'Here'));});
reloadBtn.addEventListener('click',()=>{if(lastPos)getWeather(lastPos.lat,lastPos.lon,lastPos.name);});
q.addEventListener('input',e=>{clearBtn.classList.toggle('hidden',!e.target.value);});
clearBtn.addEventListener('click',()=>{q.value='';clearBtn.classList.add('hidden');q.focus();});
</script>
</body>
</html>
