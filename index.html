<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>Search</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0&display=swap">
<style>
:root{--bg:#F9F5EC;--accent:#5C6F60;}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:#222;overflow-x:hidden;}
main{columns:2 160px;column-gap:8px;padding:8px;transition:padding .3s ease;}
main img{width:100%;border-radius:16px;margin:0 0 8px;opacity:0;transform:translateY(24px);filter:blur(4px);transition:opacity .6s cubic-bezier(.2,.8,.2,1),transform .6s cubic-bezier(.2,.8,.2,1),filter .6s;}
main img.slideL{transform:translate(-24px,24px);}
main img.slideR{transform:translate(24px,24px);}
main img.show{opacity:1;transform:translate(0,0);filter:blur(0);}
#bar{position:fixed;left:50%;bottom:calc(env(safe-area-inset-bottom) + 20px);transform:translateX(-50%);background:rgba(255,255,255,.6);backdrop-filter:blur(20px);border-radius:9999px;box-shadow:0 4px 16px rgba(0,0,0,.08);padding:8px 14px;display:flex;align-items:center;}
form{display:flex;align-items:center;}
input{flex:1;border:none;background:transparent;font-size:16px;outline:none;padding:6px;color:#222;}
input::placeholder{color:#888;}
button{border:none;background:transparent;padding:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
.material-symbols-rounded{font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24;font-size:24px;color:#222;transition:transform .2s ease,opacity .2s;}
button:active .material-symbols-rounded{transform:scale(.96);}
button:focus-visible{outline:none;}
#clear{display:none;}
@media (prefers-reduced-motion:reduce){
  main img{transition:none;}
  .material-symbols-rounded{transition:none;}
}
</style>
</head>
<body>
<main id="gallery"></main>
<div id="bar">
  <form id="form">
    <button type="submit"><span class="material-symbols-rounded">search</span></button>
    <input id="query" type="text" autocomplete="off" placeholder="Search">
    <button type="button" id="clear"><span class="material-symbols-rounded">close</span></button>
  </form>
</div>
<script>
const gallery=document.getElementById('gallery');
const form=document.getElementById('form');
const query=document.getElementById('query');
const clear=document.getElementById('clear');
const bar=document.getElementById('bar');
let page=1,term='',loading=false;

function pad(){gallery.style.paddingBottom=(bar.offsetHeight+parseInt(getComputedStyle(bar).bottom)+20)+'px';}
window.addEventListener('resize',pad);window.addEventListener('orientationchange',pad);pad();

const io=new IntersectionObserver(es=>es.forEach(e=>{if(e.isIntersecting){e.target.classList.add('show');io.unobserve(e.target);}}),{rootMargin:'50px'});
const sentinel=document.createElement('div');
const moreObs=new IntersectionObserver(es=>es.forEach(e=>{if(e.isIntersecting)load();}),{rootMargin:'500px'});

function imgEl(item,i){const img=document.createElement('img');img.src=item.url;img.alt=item.title||'img';img.loading='lazy';img.className=i%2?'slideR':'slideL';img.style.animationDelay=i*40+'ms';img.addEventListener('load',()=>io.observe(img));return img;}

async function search(q){term=q;page=1;gallery.innerHTML='';await load();}

async function load(){if(loading||!term)return;loading=true;if(sentinel.isConnected){moreObs.unobserve(sentinel);sentinel.remove();}
const r=await fetch(`https://api.openverse.engineering/v1/images?q=${encodeURIComponent(term)}&page=${page}&page_size=20`);
const d=await r.json();
const frag=document.createDocumentFragment();
d.results.forEach((it,i)=>frag.appendChild(imgEl(it,(page-1)*20+i)));
gallery.appendChild(frag);gallery.appendChild(sentinel);moreObs.observe(sentinel);
if(d.results.length)page++;loading=false;}

form.addEventListener('submit',e=>{e.preventDefault();const v=query.value.trim();if(v){clear.style.display='flex';search(v);}});
clear.addEventListener('click',()=>{query.value='';gallery.innerHTML='';clear.style.display='none';term='';});

</script>
</body>
</html>
