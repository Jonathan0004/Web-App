<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Search</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0&display=swap" rel="stylesheet"/>
<style>
:root{--bg:#F9F5EC;}
*,*::before,*::after{box-sizing:border-box;}
html,body{height:100%;margin:0;}
body{
 font-family:'Plus Jakarta Sans',sans-serif;
 background:var(--bg);
 color:#222;
 display:flex;
 align-items:center;
 justify-content:center;
 overflow:hidden;
}
img#photo{
 max-width:100%;
 max-height:100%;
 width:100%;
 height:100%;
 object-fit:cover;
 border-radius:24px;
 opacity:0;
 transform:scale(1.03);
 transition:opacity .4s ease,transform .6s cubic-bezier(.16,1,.3,1);
}
img#photo.show{opacity:1;transform:scale(1);}
.bottom{
 position:fixed;
 bottom:calc(env(safe-area-inset-bottom) + 20px);
 left:50%;
 transform:translateX(-50%);
 width:min(90%,420px);
 display:flex;
 justify-content:center;
}
.pill{
 flex:1;
 display:flex;
 align-items:center;
 gap:8px;
 padding:12px 16px;
 border-radius:999px;
 background:rgba(255,255,255,.6);
 backdrop-filter:blur(20px);
 box-shadow:0 4px 12px rgba(0,0,0,.08);
 transition:box-shadow .3s,transform .25s cubic-bezier(.2,.8,.2,1.2);
}
.pill:active{transform:scale(.96);}
.pill:focus-within{box-shadow:0 6px 16px rgba(0,0,0,.12);}
.pill input{
 flex:1;
 border:0;
 background:transparent;
 font-size:16px;
 outline:none;
 color:#333;
}
.pill span{
 font-size:24px;
 line-height:24px;
 color:#444;
 transition:transform .2s cubic-bezier(.2,.8,.2,1.2),opacity .2s;
}
.pill span:active{transform:scale(.84);}
.pill span.clear{display:none;}
#loader{
 position:fixed;
 inset:0;
 display:flex;
 align-items:center;
 justify-content:center;
 background:var(--bg);
 pointer-events:none;
 opacity:0;
 transition:opacity .4s ease;
}
#loader.show{opacity:1;}
.bar{
 width:40%;
 max-width:200px;
 height:4px;
 border-radius:2px;
 background:#ccc;
 overflow:hidden;
 color:#ccc;
 position:relative;
}
.bar .progress{
 position:absolute;
 inset:0;
 background:currentColor;
 transform:translateX(-100%);
}
@keyframes slide{from{transform:translateX(-100%);}to{transform:translateX(100%);}}
@media(prefers-reduced-motion:reduce){*{transition:none!important;animation:none!important;}}
</style>
</head>
<body>
<img id="photo" alt=""/>
<div id="loader"><div class="bar"><div class="progress"></div></div></div>
<div class="bottom">
  <div class="pill">
    <span class="material-symbols-rounded search">search</span>
    <input id="q" placeholder="Search"/>
    <span class="material-symbols-rounded clear">close</span>
  </div>
</div>
<script>
const photo=document.getElementById('photo');
const loader=document.getElementById('loader');
const bar=loader.querySelector('.bar');
const progress=bar.querySelector('.progress');
const input=document.getElementById('q');
const clearBtn=document.querySelector('.clear');
const searchIcon=document.querySelector('.search');
function avgColor(img){
 const c=document.createElement('canvas'),ctx=c.getContext('2d');
 const w=c.width=20,h=c.height=20;
 ctx.drawImage(img,0,0,w,h);
 const d=ctx.getImageData(0,0,w,h).data;let r=0,g=0,b=0;
 for(let i=0;i<d.length;i+=4){r+=d[i];g+=d[i+1];b+=d[i+2];}
 const n=d.length/4;return`rgb(${r/n|0},${g/n|0},${b/n|0})`;
}
function runBar(){
 progress.style.animation='none';
 void progress.offsetWidth; // restart
 progress.style.animation='slide .7s forwards';
}
function search(q){
 if(!q.trim())return;
 loader.classList.add('show');
 bar.style.color='#ccc';
 runBar();
 const img=new Image();
 img.crossOrigin='anonymous';
 img.src=`https://source.unsplash.com/1600x900/?${encodeURIComponent(q)}`;
 img.onload=()=>{
   let color='#ccc';
   try{color=avgColor(img);}catch(e){console.warn('avgColor failed',e);}
   bar.style.color=color;
   loader.style.background=color.replace('rgb','rgba').replace(')',',0.2)');
   photo.classList.remove('show');
   photo.src=img.src;
   runBar();
   setTimeout(()=>{loader.classList.remove('show');photo.classList.add('show');},700);
 };
 img.onerror=()=>{loader.classList.remove('show');};
}
input.addEventListener('keydown',e=>{if(e.key==='Enter')search(input.value);});
searchIcon.addEventListener('click',()=>search(input.value));
clearBtn.addEventListener('click',()=>{input.value='';clearBtn.style.display='none';input.focus();});
input.addEventListener('input',()=>{clearBtn.style.display=input.value? 'block':'none';});
</script>
</body>
</html>
