<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>Image Search</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0&display=swap">
<style>
:root{
  --bg:#F9F5EC;
  --accent:#444;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body,html{margin:0;height:100%;background:var(--bg);font-family:'Inter',sans-serif;color:#222;}
#app{position:relative;height:100dvh;overflow:hidden;}
#img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .4s ease;}
#loader{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;backdrop-filter:blur(20px);background:rgba(249,245,236,.6);opacity:0;pointer-events:none;transition:opacity .2s ease;}
#loader.active{opacity:1;}
#bar{width:120px;height:4px;border-radius:2px;overflow:hidden;background:rgba(0,0,0,.1);}
#bar span{display:block;height:100%;width:100%;background:var(--bar);transform:translateX(-100%);}
#bar.run span{animation:slide .6s cubic-bezier(.4,0,.2,1) forwards;}
@keyframes slide{to{transform:translateX(0);}}
#controls{position:absolute;bottom:0;left:0;right:0;display:flex;justify-content:center;padding:0 16px 16px;padding-bottom:calc(16px + env(safe-area-inset-bottom));pointer-events:none;}
.pill{flex:1;max-width:360px;height:44px;display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.6);backdrop-filter:blur(20px);border-radius:22px;padding:0 16px;box-shadow:0 4px 16px rgba(0,0,0,.08);pointer-events:auto;touch-action:manipulation;transition:transform .2s cubic-bezier(.2,.8,.2,1);}
.pill:active{transform:scale(.96);}
.pill input{flex:1;border:none;background:transparent;outline:none;font-size:16px;color:var(--accent);}
.pill button{border:none;background:transparent;padding:0;margin:0;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s cubic-bezier(.2,.8,.2,1);touch-action:manipulation;}
.pill button:active{transform:scale(.96);}
.material-symbols-rounded{font-variation-settings:'FILL' 0,'wght' 600,'GRAD' 0,'opsz' 24;font-size:24px;line-height:1;display:inline-flex;align-items:center;justify-content:center;color:var(--accent);}
@media (prefers-reduced-motion:reduce){
 *{transition:none!important;animation:none!important;}
}
</style>
</head>
<body>
<div id="app">
  <img id="img" alt="">
  <div id="loader">
    <div id="bar"><span></span></div>
  </div>
  <div id="controls">
    <form id="form" class="pill" autocomplete="off">
      <span class="material-symbols-rounded">search</span>
      <input id="query" type="search" placeholder="Search">
      <button type="button" id="clear" aria-label="clear" style="display:none;">
        <span class="material-symbols-rounded">close</span>
      </button>
    </form>
  </div>
</div>
<script>
const q=document.getElementById('query');
const img=document.getElementById('img');
const loader=document.getElementById('loader');
const bar=document.getElementById('bar');
const barSpan=bar.querySelector('span');
const form=document.getElementById('form');
const clearBtn=document.getElementById('clear');
function avgColor(image){
  const canvas=document.createElement('canvas');
  const ctx=canvas.getContext('2d');
  canvas.width=image.naturalWidth;
  canvas.height=image.naturalHeight;
  ctx.drawImage(image,0,0);
  const data=ctx.getImageData(0,0,canvas.width,canvas.height).data;
  let r=0,g=0,b=0,count=0;
  for(let i=0;i<data.length;i+=40){r+=data[i];g+=data[i+1];b+=data[i+2];count++;}
  r=Math.round(r/count);g=Math.round(g/count);b=Math.round(b/count);
  return `rgb(${r},${g},${b})`;
}
function search(term){
  if(!term) return;
  loader.classList.add('active');
  img.style.opacity=0;
  const url=`https://source.unsplash.com/800x600/?${encodeURIComponent(term)}&${Date.now()}`;
  const temp=new Image();
  temp.crossOrigin='anonymous';
  temp.src=url;
  temp.onload=()=>{
    const color=avgColor(temp);
    barSpan.style.background=color;
    bar.classList.add('run');
    setTimeout(()=>{
      img.src=url;
      img.onload=()=>{img.style.opacity=1;};
      loader.classList.remove('active');
      bar.classList.remove('run');
    },650);
  };
}
form.addEventListener('submit',e=>{
  e.preventDefault();
  search(q.value.trim());
});
q.addEventListener('input',()=>{
  clearBtn.style.display=q.value?'flex':'none';
});
clearBtn.addEventListener('click',()=>{
  q.value='';
  clearBtn.style.display='none';
  q.focus();
});
</script>
</body>
</html>
